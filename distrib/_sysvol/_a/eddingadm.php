<?php if (!defined('inpanel')) die("no access");$global_acs = get_accesslvl($db);if(isset($_REQUEST["addd"])){ if ($global_acs==100) {  $error = false;  $alname = substr($_POST["admname"],0,10);  $anpwd = substr($_POST["admpwd"],0,10);  $anikc = substr($_POST["admnick"],0,10);  $access = substr($_POST["admacs"],0,3);    $query = $db->query("SELECT * FROM MWC_admin");  while($getlist = $query->FetchRow())  {   if($getlist["name"] == $alname)   {    $error = true;    break;   }  }   if($error==false)  {   $db->query("INSERT INTO MWC_admin (name,pwd,nick,access)VALUES('".$alname."','".md5($anpwd)."','".$anikc."','".$access."')");   logs::WriteLogs ("Adm_","администратор ".$_SESSION["sadmin"]." добавил $alname в качестве администратора");   header("Location:".$config["siteaddress"]."/control.php?page=eddingadm");  } } else  echo "<div style='text-align:center'>You don't have access to use this module</div>";}elseif(isset($_REQUEST["edittt"])){ $alname = substr($_POST["admname"],0,10); $anpwd = substr($_POST["admpwd"],0,10); $anikc = substr($_POST["admnick"],0,10);  $query = $db->query("SELECT count(*) as cnt FROM MWC_admin WHERE name='".$alname."'")->FetchRow();  if($query["cnt"]==1) {  if ($global_acs==100 or $alname==$_SESSION["sadmin"])  {   if ($global_acs==100) $access = substr(validate($_POST["admacs"]),0,3);   else $access=$global_acs;      if ($anpwd=!"md5hash")       $db->query("UPDATE MWC_admin SET pwd = '".md5($anpwd)."', [access] ='".$access."', [nick]='".$anikc."' WHERE name='".$alname."'");    else       $db->query("UPDATE MWC_admin SET [access] ='".$access."', [nick]='".$anikc."' WHERE name='".$alname."'");   logs::WriteLogs ("Adm_","администратор ".$_SESSION["sadmin"]." изменил ".$alname."'у пароль или уровень доступа");  } } header("Location:".$config["siteaddress"]."/control.php?page=eddingadm");}if(!isset($_GET["act"])){ $content->out("edda_h.html"); $query = $db->query("SELECT * FROM MWC_admin"); while($getlist = $query->FetchRow()) {  $content->set('|adm_aval|',  $getlist["name"]);  if($getlist["name"] != $_SESSION["sadmin"])    $content->set('|adm_oval|',  "<a href='".$config["siteaddress"]."/control.php?page=eddingadm&act=edit&editid=".$getlist["id"]."'>[Edit]</a>&nbsp;<a href='".$config["siteaddress"]."/control.php?page=eddingadm&act=del&delid=".$getlist["id"]."'>[Delete]</a>");  else    $content->set('|adm_oval|',  "<a href='".$config["siteaddress"]."/control.php?page=eddingadm&act=edit&editid=".$getlist["id"]."'>[Edit]</a>");      $content->out("edda_c.html"); } $content->out("edda_f.html");}else{ switch($_GET["act"]) {  case "add":   if($global_acs==100)  {   $content->set('|adm_aval|',  "");   $content->set('|adm_apwd|',  "");   $content->set('|adm_anick|',  "");   $content->set('|adm_acs|',  1);   $content->set('|adm_bname|',  "addd");   $content->out("edda_edit.html");  }  else   echo "<div style='text-align:center'>You don't have access to use this module</div>";  break;  case "edit":  $eid = (int)$_GET["editid"];  $chec = $db->query("SELECT [name],[access],[nick] FROM MWC_admin WHERE id=".$eid."")->FetchRow();  if ($chec["name"] == $_SESSION["sadmin"] or $global_acs==100)  {   $content->set('|adm_bname|',  "edittt");   $content->set('|adm_aval|',  $chec["name"]);   $content->set('|adm_acs|',  $chec["access"]);   $content->set('|adm_anick|',  $chec["nick"]);   $content->set('|adm_apwd|',  "md5hash");   $content->out("edda_edit.html");  }  else   echo "<div style='text-align:center'>You don't have access to use this module</div>";  break;  case "del":   if($global_acs==100)   {    $did = (int)$_GET["delid"];    $chec = $db->query("SELECT name FROM MWC_admin WHERE id='". $did."'")->FetchRow();    if ($chec["name"] != $_SESSION["sadmin"])    {     $db->query("DELETE FROM MWC_admin WHERE id='". $did."'");     logs::WriteLogs ("Adm_","администратор ".$_SESSION["sadmin"]." удалил администратора $chec[0]");    }    else     logs::WriteLogs ("Adm_","администратор ".$_SESSION["sadmin"]." пытался удалить сам себя о0");    header("Location:".$config["siteaddress"]."/control.php?page=eddingadm");   }   else    echo "<div style='text-align:center'>You don't have access to use this module</div>";   break;  default:die("wrong action type!"); }}